<!DOCTYPE html>
<html>
    <head>
        <title>Cadastro de cliente</title>
        <meta charset="UTF-8">
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.0/jquery.mask.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<link rel="shortcut icon" href="https://image.flaticon.com/icons/png/512/57/57134.png" type="image/x-icon" />
<script src="js/moment.js"></script>
<script>
$(function() {
	//MASCARA DE DATAS
	$( "#data_nasc" ).mask('99/99/9999');
	//$( "#data_nasc" ).datepicker();
	
	//$( "#busca_semana_1" ).mask('99/99/9999');
	//$( "#busca_semana_1" ).datepicker();
	//$( "#busca_semana_2" ).mask('99/99/9999');
	//$( "#busca_semana_2" ).datepicker();
	setDialog();
});
function seleciona(id)
{
    obj = document.frm_form;
	//ajax que carrega os dados
	$.ajax({
    method: "POST",
    url: "ajax_busca.php",
    data: {
		'id' :id		
		},
	success: function(data) 
		{
		
			obj.id_cliente.value = data.id;
			obj.nome.value = data.nome;
			obj.data_nasc.value = data.data_nasc;
			obj.breve_desc.value = data.breve_desc;
			adiciona_imagem(id);
		},	
		dataType:"json"
   })

	
}
function adiciona_imagem(id)
{
obj = document.frm_form;
	//ajax que carrega os dados
	$.ajax({
    method: "POST",
    url: "ajax_carrega_imagem.php",
    data: {
		'id' :id		
		},
	success: function(data) 
		{
			var display = document.getElementById('container_imagem').style.display;
			if(display == "none")
			document.getElementById('container_imagem').style.display = 'block';
			
			//Mudarestado('container_imagem');
			$("#carrega_imagem").html(data);
			
		}
   })
}
function Finalizar(parametro)
{
	obj = document.frm_form;
	if(parametro == 1)
	{
		
		if(obj.id_cliente.value != '')
		{
			alert('Por favor insira um novo registro!');
		}else{
			obj = document.frm_form;
			obj.acao.value = parametro;
			obj.submit();
			}
	}
	else if(parametro == 3)
	{
		if(obj.id_cliente.value == '')
		{
				alert('Por favor selecione um registro!');
		}
			else{
		obj = document.frm_form;
		obj.acao.value = parametro;
		obj.submit();
		}

	}
	else if(parametro == 2){
		if(obj.id_cliente.value == '')
		{
				alert('Por favor selecione um registro!');
		}
		else{
				obj = document.frm_form;
				obj.acao.value = parametro;
				obj.submit();
			}
	}
}
function Validar()
{
obj = document.frm_form;

	if(obj.nome.value == '')
	{
	alert('Favor preencher o Nome!');
	obj.nome.focus();
	return false;
	}
	else if(obj.data_nasc.value == '')
	{
	alert('Favor preencher a Data de nascimento!');
	obj.data_nasc.focus();
	return false;
	}
	else if(obj.breve_desc.value == '')
	{
	alert('Favor preencher a Descrição!');
	obj.breve_desc.focus();
	return false;
	}
	else return true;
}
function Mudarestado(el) 
{
	var display = document.getElementById(el).style.display;
	if(display == "none")
	document.getElementById(el).style.display = 'block';
	else
	document.getElementById(el).style.display = 'none';
}
function Buscar()
{
	/*obj = document.frm_form;
	obj.acao.value = '4';
	obj.submit();*/
	var busca_dia      = document.getElementById('busca_dia').value;
	var busca_mes      = document.getElementById('busca_mes').value;
	var busca_semana_1 = document.getElementById('primeiro_dia_semana').value;
	var busca_semana_2 = document.getElementById('ultimo_dia_semana').value;
	var mes = document.getElementById('mes').value;
	var busca_nome     = document.getElementById('busca_nome').value;
	//alert(busca_semana_1);
	
	$.ajax({
    method: "POST",
    url: "ajax_carrega_dados.php",
    data: {
		'busca_dia': busca_dia, 
		'busca_mes': busca_mes,
		'busca_semana_1': busca_semana_1,
		'busca_semana_2': busca_semana_2,
		'busca_nome': busca_nome,
		'mes': mes
		},
	success: function(data) 
		{
			$("#resultado").html(data);
			fecharDialog();
			
	document.getElementById('combo_resultado').style.display = 'block';
			//Mudarestado('combo_resultado');
			//if(dat ==1)
		}	
   })

} 

function Semana(semana)
{
	/*var ano = moment().get('year');
	var ultimo_dia = moment(`${ano}-${mes}`).endOf('month').format('DD');
	var dia_semana = moment(`${ano}-${mes}-1`).day();
	if(ultimo_dia==31)
	{
		//moment().weekDay();
	}*/
	var primeiro_dia_semana = 0, ultimo_dia_semana = 0;
	var mes = 0;
	var mes_ultimo_dia =0;
	
		var {_d} = moment().day('Sunday').week(semana);
		
		if (moment().get('year') != _d.getFullYear()) {
			if (moment().get('year') > _d.getFullYear()) {
				primeiro_dia_semana = 1;
				mes = 1;
			}
			else {
				dia = moment().day('Sunday').week(semana - 1);
				ultimo_dia_semana = 31;
				mes = 12;
			}
		}
	//var {_d} = moment().day('Sunday').week(semana);
	
			//mes = _d.getMonth();
		if(primeiro_dia_semana == 0)
		{
			primeiro_dia_semana = _d.getDate();
			mes =(_d.getMonth())+1;
		}
		var {_d} = moment().day('Saturday').week(semana);
		mes_ultimo_dia = _d.getMonth()+1;
		if(ultimo_dia_semana==0)
			ultimo_dia_semana = _d.getDate();
		if(mes != mes_ultimo_dia)
		{
			var {_d} = moment(`${moment().get('year')}-${mes}`).endOf('month');
			ultimo_dia_semana = _d.getDate();
		}	
		//var {_d} = moment().day('Saturday').week(semana);
console.log(mes);
document.getElementById('ultimo_dia_semana').value = ultimo_dia_semana;
document.getElementById('primeiro_dia_semana').value = primeiro_dia_semana;
document.getElementById('mes').value = mes;
}

function setDialog() {
$("#div_busca").dialog({
autoOpen: false,
width: 800,
modal: true,
resizable: false,
title: 'Buscar',
close: function() { 
}
});
}

function abrirDialog() {
$('#div_busca').dialog('open');
}

function fecharDialog() {
$('#div_busca').dialog('close'); 
}
function imprimir(valor, versao)
{
	obj = document.frm_form;
	var busca_dia      = document.getElementById('busca_dia').value;
	var busca_mes      = document.getElementById('busca_mes').value;
	var busca_semana_1 = document.getElementById('busca_semana_1').value;
	var busca_semana_2 = document.getElementById('busca_semana_2').value;
	var busca_nome     = document.getElementById('busca_nome').value;

List = window.open(valor+"?busca_dia="+busca_dia+"&busca_mes="+busca_mes+"&busca_semana_1="+busca_semana_1+"&busca_semana_2="+busca_semana_2+"&busca_nome="+busca_nome,"list", "scrollbars=no, width=390,height=240");
}


</script>
<style>
input[type=button]
{
width:15%;
}
fieldset.scheduler-border {
border: 1px groove #ddd !important;
padding: 0 1.4em 1.4em 1.4em !important;
margin: 0 0 1.5em 0 !important;
-webkit-box-shadow:  0px 0px 0px 0px #000;
box-shadow:  0px 0px 0px 0px #000;

}

legend.scheduler-border {
font-size: 1.2em !important;
font-weight: bold !important;
text-align: left !important;
border:none;
width:100px;
}


</style>
 
    </head>
<form id="frm_form" name="frm_form" action="proc_cliente.php" method="POST" enctype='multipart/form-data'>
    <body style="background:#ffffff; align:left; text-align:left;">

<!--Barra de navegação-->
<nav class="navbar navbar-inverse">
 <div class="container-fluid">
<div class="navbar-header">
 <a class="navbar-brand" href="#">Cadastro de cliente</a>
</div>
<ul class="nav navbar-nav">
 <li class="active"><a href="#">Home</a></li>
</ul>
 </div>
</nav>

    <!--Conteudo-->
	<div id="conteudo" style="margin-left:1%;">
	<fieldset class="scheduler-border">
		<legend class="scheduler-border">Informações:</legend>
		<div id="container_imagem" style="position:absolute;  text-align:right; float:rigth; margin-left:80%; display:none">
			<fieldset class="scheduler-border">
			<legend class="scheduler-border">Foto:</legend>
				<div id="carrega_imagem" >
				</div>
			</fieldset>
		</div>
		 <div class="row">
			 <div class="col-md-8">
			 <label for="nome">Nome:</label>
			 <input type="text"  class="form-control form-control-sm"  name="nome" id="nome" required>
			 </div> 
		 </div><br>
		 <div class="row">
			 <div class="col-md-4">
				 <label for="data_nasc">Data nascimento:</label>
				 <input type="text"  class="form-control form-control-sm"  name="data_nasc" id="data_nasc">
			 </div>
			 <div class="col-md-4">
				 <label for="foto">Foto:</label>
				 <input type="file" class="form-control-file" id="foto" name="foto" value="Buscar foto...">
			 </div>
		 </div><br>
		 <div class="row">
			 <div class="col-md-8">
				<label for="breve_desc">Breve descrição:</label>
				<textarea id="breve_desc" class="form-control form-control-sm" name="breve_desc" rows="2" cols="70" placeholder="descrição ..."></textarea>
			</div> 
		</div>
		
	</fieldset>

	<br>
	<div class="row" style="margin-left:1%;">
		<input type="button" value="Novo" id="btn_novo"  class="btn btn-dark"  onclick="window.location.href = 'index.html'">
		<input type="button" value="Salvar" id="btn_salvar"  class="btn btn-dark"  onclick="if(Validar())Finalizar(1);">
		<input type="button" value="Alterar" id="btn_alterar" class="btn btn-dark" onclick="Finalizar(2);">
		<input type="button" value="Buscar" id="btn_buscar" class="btn btn-dark" onclick="abrirDialog();">
		<input type="button" value="Excluir" id="btn_excluir" class="btn btn-dark" onclick="Finalizar(3);">
	</div>
	<input type="hidden" id="acao" name="acao">
	<input type="hidden" id="id_cliente" name="id_cliente">
	<input type="hidden" id="ultimo_dia_semana">
	<input type="hidden" id="primeiro_dia_semana">
	<input type="hidden" id="mes">

	</div>
 <br><br><br>
  <div id="div_busca" class="control-group" style="display:none; background:#ffffff; width:80%;">
	<fieldset class="scheduler-border">
	<legend class="scheduler-border">Filtros:</legend>
	<div class="row">
		<div class="col-md-5">
			 <label for="busca_mes">Mês de aniversario:</label>
			 <select name="busca_mes" id="busca_mes"  class="form-control form-control-sm" >
				<option value="0" selected> --Selecione--</option>
				<option value="1">Janeiro</option> 
				<option value="2">Fevereiro</option> 
				<option value="3">Março</option> 
				<option value="4">Abril</option> 
				<option value="5">Maio</option> 
				<option value="6">Junho</option> 
				<option value="7">Julho</option> 
				<option value="8">Agosto</option>
				<option value="9">Setembro</option> 
				<option value="10">Outubro</option> 
				<option value="11">Novembro</option> 
				<option value="12">Dezembro</option> 
			</select>
		</div>
	</div>	
	<br>
	<div class="row">	
		<div class="col-md-5">
			<label for="busca_semana">Semana de aniversario:</label>
			<br>
			<input name="busca_semana_1" id="busca_semana_1"  class="form-control form-control-sm" type="text" onblur="Semana(this.value);">
				
		</div>
		<div class="col-md-5">
			<br><input type="text" id="busca_semana_2"  class="form-control">

		</div>
		
	 </div>
	 <br>
	 <div class="row">
		<div class="col-md-5">
		 <label for="busca_dia">Dia de aniversario:</label>
		 <input type="text" id="busca_dia" class="form-control">
		</div>
		<div class="col-md-5">
		 <label for="busca_nome">Nome:</label>
		 <input type="text" id="busca_nome" class="form-control">
		</div>
	 </div>
	 </fieldset>
	 <input type="button" id="btn_busca_aniversario" name="btn_busca_aniversario" class="btn btn-dark" value="Buscar" onclick="Buscar();">
	 <input type="button" id="btn_busca_aniversario" name="btn_busca_aniversario" class="btn btn-dark" style="width:20%" value="Imprimir PDF" onclick="imprimir('imprimir.php', 'd');">
 </div>
 <div id="combo_resultado" style="display:none; width:80%; margin-left:1%; background:#FAFAFA;">
	 <fieldset class="scheduler-border">
		 <div id="resultado" >
		 
		 </div>
	</fieldset>
 </div>
    </body>
</form>
</html>


